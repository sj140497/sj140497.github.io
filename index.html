<!DOCTYPE html>
<html>
<title>Q5040916</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<style>
body,h1 {font-family: "Raleway", sans-serif}
body, html {height: 100%}
.bgimg {
    background-image: url('https://raw.githubusercontent.com/sj140497/FinalYearDAW/master/Misc/hUPIsqu.jpg');
    min-height: 100%;
    background-position: center;
    background-size: cover;
}
</style>
<body> 
<div class="bgimg w3-display-container w3-animate-opacity w3-text-white">
  <div class="w3-display-topleft w3-padding-large w3-xlarge">
  </div>
  <div class="w3-display-middle">
    <h1 class="w3-jumbo w3-animate-top">Sean Johnson: Final Year Project</h1>
    <hr class="w3-border-grey" style="margin:auto;width:40%">
    <p class="w3-large w3-center">Digital Audio Workshop</p>
    <button id="songControl" onclick="songControls()"> Pause </button>
    <form>
        <p>Volume</p><input type="range" name="volumeControl" min="0" max="1" step="any" onchange="changeVolume(this.value);">
        <p>Lowshelf</p><input type="range" name="biquadControl" min="40" max="440" step="any" onchange="changeBiquad(this.value);">
        <p>Distortion</p><input type="range" name="distortionControl" min="0" max="300" step="any" onchange="changeDistortion(this.value);">
    </form>
  </div>
</div>
    <script>
                  
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        var voiceSelect = document.getElementById("voice");
        var source;
        var stream;
        
        //Code from Kevin Ennis - Day 2 + 3 of blog:
        function makeDistortionCurve(amount) {
        var k = typeof amount === 'number' ? amount : 50,
          n_samples = 44100,
          curve = new Float32Array(n_samples),
          deg = Math.PI / 180,
          i = 0,
          x;
        for ( ; i < n_samples; ++i ) {
          x = i * 2 / n_samples - 1;
          curve[i] = ( 3 + k ) * x * 20 * deg / ( Math.PI + k * Math.abs(x) );
        }
        return curve;
      };
        
        var gainNode = ctx.createGain();
        gainNode.gain.value = 0.5;
        gainNode.connect(ctx.destination);
        
        var analyser = ctx.createAnalyser();
        analyser.minDecibels = -90;
        analyser.maxDecibels = -10;
        analyser.smoothingTimeConstant = 0.85;
        
        var distortion = ctx.createWaveShaper();
        distortion.connect(gainNode);
        
        var biquadFilter = ctx.createBiquadFilter();
        biquadFilter.type = "lowshelf";
        biquadFilter.frequency.value = 40;
        biquadFilter.gain.value = 25;
        biquadFilter.connect(distortion);
        
        var convolver = ctx.createConvolver();
        
        
      
      //https://raw.githubusercontent.com/sj140497/FinalYearDAW/master/Misc/4062.mp3
      
      //Hardcoding a single song in for now until I figure out multiple songs
    var soundSource, songBuffer;
    request = new XMLHttpRequest();
    request.open('GET', 'https://raw.githubusercontent.com/sj140497/FinalYearDAW/master/Misc/4062.mp3', true);
    request.responseType = 'arraybuffer';

    request.onload = function() {
      var audioData = request.response;

      ctx.decodeAudioData(audioData, function(buffer) {
          songBuffer = buffer;
          soundSource = ctx.createBufferSource();
          soundSource.buffer = songBuffer;
          soundSource.connect(biquadFilter);
          soundSource.loop = true;
          soundSource.start();
        }, function(e){ console.log("Error with decoding audio data" + e.err);});
    };

    request.send();  
    //End of playing single song

        //Function to pause and resume current song onclick of button        
        function songControls() {
            if(ctx.state === 'running') {
                ctx.suspend().then(function() {
                    document.getElementById("songControl").textContent = "Resume";
                });
            } else if(ctx.state === 'suspended') {
                ctx.resume().then(function() {
                    document.getElementById("songControl").textContent = "Pause";
                });
            }
        }
        //Pause and resume function end
        
        //functions to update values of volume/effects based on change in slider
        function changeVolume(val) {
            gainNode.gain.value = val;
        }
        
        function changeBiquad(val) {
            biquadFilter.frequency.value = val;
        }
        
        function changeDistortion(val) {
            distortion.curve = makeDistortionCurve(val);
        }
    </script>
</body>
</html>



<!--function voiceChange() {

        distortion.oversample = '4x';
        biquadFilter.gain.value = 0;
        convolver.buffer = undefined;

        var voiceSetting = voiceSelect.value;
        console.log(voiceSetting);

        if(voiceSetting == "distortion") {
          distortion.curve = makeDistortionCurve(400);
        } else if(voiceSetting == "convolver") {
          //convolver.buffer = concertHallBuffer;
          convolver.buffer = buffer;
        } else if(voiceSetting == "biquad") {
          biquadFilter.type = "lowshelf";
          biquadFilter.frequency.value = 1000;
          biquadFilter.gain.value = 25;
        } else if(voiceSetting == "off") {
          console.log("Voice settings turned off");
        }
      }-->